<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.youyuan.vhr.mapper.EmployeeMapper">
    <resultMap id="BaseResultMap" type="org.youyuan.vhr.bean.Employee">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="gender" property="gender" jdbcType="CHAR"/>
        <result column="birthday" property="birthday" jdbcType="DATE"/>
        <result column="idCard" property="idCard" jdbcType="CHAR"/>
        <result column="wedlock" property="wedlock" jdbcType="CHAR"/>
        <result column="nationId" property="nationId" jdbcType="INTEGER"/>
        <result column="nativePlace" property="nativePlace" jdbcType="VARCHAR"/>
        <result column="politicId" property="politicId" jdbcType="INTEGER"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="departmentId" property="departmentId" jdbcType="INTEGER"/>
        <result column="jobLevelId" property="jobLevelId" jdbcType="INTEGER"/>
        <result column="posId" property="posId" jdbcType="INTEGER"/>
        <result column="engageForm" property="engageForm" jdbcType="VARCHAR"/>
        <result column="tiptopDegree" property="tiptopDegree" jdbcType="CHAR"/>
        <result column="specialty" property="specialty" jdbcType="VARCHAR"/>
        <result column="school" property="school" jdbcType="VARCHAR"/>
        <result column="beginDate" property="beginDate" jdbcType="DATE"/>
        <result column="workState" property="workState" jdbcType="CHAR"/>
        <result column="workID" property="workID" jdbcType="CHAR"/>
        <result column="contractTerm" property="contractTerm" jdbcType="DOUBLE"/>
        <result column="conversionTime" property="conversionTime" jdbcType="DATE"/>
        <result column="notWorkDate" property="notWorkDate" jdbcType="DATE"/>
        <result column="beginContract" property="beginContract" jdbcType="DATE"/>
        <result column="endContract" property="endContract" jdbcType="DATE"/>
        <result column="workAge" property="workAge" jdbcType="INTEGER"/>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from employee
    where id = #{id,jdbcType=INTEGER}
    </delete>

    <insert id="insert" parameterType="org.youyuan.vhr.bean.Employee" useGeneratedKeys="true" keyProperty="id">
    insert into employee (id, name, gender,
      birthday, idCard, wedlock, nationId,
      nativePlace, politicId, email,
      phone, address, departmentId,
      jobLevelId, posId, engageForm,
      tiptopDegree, specialty, school,
      beginDate, workState, workID,
      contractTerm, conversionTime, notWorkDate,
      beginContract, endContract, workAge
      )
    values (#{id,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR}, #{gender,jdbcType=CHAR},
      #{birthday,jdbcType=DATE}, #{idCard,jdbcType=CHAR}, #{wedlock,jdbcType=CHAR}, #{nationId,jdbcType=INTEGER},
      #{nativePlace,jdbcType=VARCHAR}, #{politicId,jdbcType=INTEGER}, #{email,jdbcType=VARCHAR},
      #{phone,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR}, #{departmentId,jdbcType=INTEGER},
      #{jobLevelId,jdbcType=INTEGER}, #{posId,jdbcType=INTEGER}, #{engageForm,jdbcType=VARCHAR},
      #{tiptopDegree,jdbcType=CHAR}, #{specialty,jdbcType=VARCHAR}, #{school,jdbcType=VARCHAR},
      #{beginDate,jdbcType=DATE}, #{workState,jdbcType=CHAR}, #{workID,jdbcType=CHAR},
      #{contractTerm,jdbcType=DOUBLE}, #{conversionTime,jdbcType=DATE}, #{notWorkDate,jdbcType=DATE},
      #{beginContract,jdbcType=DATE}, #{endContract,jdbcType=DATE}, #{workAge,jdbcType=INTEGER}
      )
  </insert>
    <update id="updateByPrimaryKey" parameterType="org.youyuan.vhr.bean.Employee">
    update employee
    set name = #{name,jdbcType=VARCHAR},
      gender = #{gender,jdbcType=CHAR},
      birthday = #{birthday,jdbcType=DATE},
      idCard = #{idCard,jdbcType=CHAR},
      wedlock = #{wedlock,jdbcType=CHAR},
      nationId = #{nationId,jdbcType=INTEGER},
      nativePlace = #{nativePlace,jdbcType=VARCHAR},
      politicId = #{politicId,jdbcType=INTEGER},
      email = #{email,jdbcType=VARCHAR},
      phone = #{phone,jdbcType=VARCHAR},
      address = #{address,jdbcType=VARCHAR},
      departmentId = #{departmentId,jdbcType=INTEGER},
      jobLevelId = #{jobLevelId,jdbcType=INTEGER},
      posId = #{posId,jdbcType=INTEGER},
      engageForm = #{engageForm,jdbcType=VARCHAR},
      tiptopDegree = #{tiptopDegree,jdbcType=CHAR},
      specialty = #{specialty,jdbcType=VARCHAR},
      school = #{school,jdbcType=VARCHAR},
      beginDate = #{beginDate,jdbcType=DATE},
      workState = #{workState,jdbcType=CHAR},
      workID = #{workID,jdbcType=CHAR},
      contractTerm = #{contractTerm,jdbcType=DOUBLE},
      conversionTime = #{conversionTime,jdbcType=DATE},
      notWorkDate = #{notWorkDate,jdbcType=DATE},
      beginContract = #{beginContract,jdbcType=DATE},
      endContract = #{endContract,jdbcType=DATE},
      workAge = #{workAge,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select id, name, gender, birthday, idCard, wedlock, nationId, nativePlace, politicId,
    email, phone, address, departmentId, jobLevelId, posId, engageForm, tiptopDegree,
    specialty, school, beginDate, workState, workID, contractTerm, conversionTime, notWorkDate,
    beginContract, endContract, workAge
    from employee
    where id = #{id,jdbcType=INTEGER}
  </select>
    <select id="selectAll" resultMap="BaseResultMap">
    select id, name, gender, birthday, idCard, wedlock, nationId, nativePlace, politicId,
    email, phone, address, departmentId, jobLevelId, posId, engageForm, tiptopDegree,
    specialty, school, beginDate, workState, workID, contractTerm, conversionTime, notWorkDate,
    beginContract, endContract, workAge
    from employee
  </select>


    <resultMap id="AllEmpInfo" type="org.youyuan.vhr.bean.Employee" extends="BaseResultMap">
        <association property="nation" javaType="org.youyuan.vhr.bean.Nation">
            <id property="id" column="id"></id>
            <result property="name" column="naname"></result>
        </association>
        <association property="politicsStatus" javaType="org.youyuan.vhr.bean.PoliticsStatus">
            <id property="id" column="id"></id>
            <result property="name" column="poname"></result>
        </association>
        <association property="department" javaType="org.youyuan.vhr.bean.Department">
            <id property="id" column="id"></id>
            <result property="name" column="depname"></result>
        </association>
        <association property="jobLevel" javaType="org.youyuan.vhr.bean.JobLevel">
            <id property="id" column="id"></id>
            <result property="name" column="jobname"></result>
        </association>
        <association property="position" javaType="org.youyuan.vhr.bean.Position">
            <id property="id" column="id"></id>
            <result property="name" column="posname"></result>
        </association>
    </resultMap>
    <!--查询发送邮件员工的信息-->
    <select id="getEmployeeById" resultMap="AllEmpInfo">
        SELECT emp.* ,
        na.`name` AS 'naname',
        po.`name` AS 'poname',
        dep.`name` AS 'depname',
        job.`name` AS 'jobname',
        pos.`name` AS 'posname'
        FROM employee AS emp,
        nation AS na,
        politicsstatus AS po,
        department AS dep,
        joblevel AS job ,
        position AS pos
        WHERE na.id=emp.nationId AND po.id=emp.politicId AND dep.id = emp.departmentId
        AND job.id = emp.jobLevelId AND pos.id=emp.posId and emp.id=#{id}
    </select>
    <!--分页查询-->
    <select id="getEmployeeByPage" resultMap="AllEmpInfo">
        SELECT emp.* ,
        na.`name` AS 'naname',
        po.`name` AS 'poname',
        dep.`name` AS 'depname',
        job.`name` AS 'jobname',
        pos.`name` AS 'posname'
        FROM employee AS emp,
        nation AS na,
        politicsstatus AS po,
        department AS dep,
        joblevel AS job ,
        position AS pos
        WHERE na.id=emp.nationId AND po.id=emp.politicId AND dep.id = emp.departmentId
        AND job.id = emp.jobLevelId AND pos.id=emp.posId
        <if test="emp.name != null and emp.name!=''">
            and emp.name like concat('%',#{emp.name},'%')
        </if>
        <if test="emp.politicId!=null">
            and emp.politicId = #{emp.politicId}
        </if>
        <if test="emp.nationId!=null">
            and emp.nationId = #{emp.nationId}
        </if>
        <if test="emp.jobLevelId!=null">
            and emp.jobLevelId = #{emp.jobLevelId}
        </if>
        <if test="emp.posId!=null">
            and emp.posId = #{emp.posId}
        </if>
        <if test="emp.engageForm!=null and emp.engageForm!=''">
            and emp.engageForm = #{emp.engageForm}
        </if>
        <if test="emp.departmentId!=null">
            and emp.departmentId = #{emp.departmentId}
        </if>
        <if test="beginDateScope!=null">
            and emp.beginDate between #{beginDateScope[0]} and #{beginDateScope[1]}
        </if>
        <if test="page != null and size!= null">
            LIMIT #{page},#{size}
        </if>

    </select>

    <!--查询总记录数-->
    <select id="getTotal" resultType="java.lang.Long">
        select count(*) from employee as emp
        <where>
            <if test="emp!=null">
                <if test="emp.name!=null and emp.name!=''">
                    and emp.name like concat('%',#{emp.name},'%')
                </if>
                <if test="emp.politicId!=null">
                    and emp.politicId = #{emp.politicId}
                </if>
                <if test="emp.nationId!=null">
                    and emp.nationId = #{emp.nationId}
                </if>
                <if test="emp.jobLevelId!=null">
                    and emp.jobLevelId = #{emp.jobLevelId}
                </if>
                <if test="emp.posId!=null">
                    and emp.posId = #{emp.posId}
                </if>
                <if test="emp.engageForm!=null and emp.engageForm!=''">
                    and emp.engageForm = #{emp.engageForm}
                </if>
                <if test="emp.departmentId!=null">
                    and emp.departmentId = #{emp.departmentId}
                </if>
                <if test="beginDateScope!=null">
                    and emp.beginDate between #{beginDateScope[0]} and #{beginDateScope[1]}
                </if>
            </if>
        </where>
    </select>

    <!--获取最大工号-->
    <select id="getMaxWorkID" resultType="java.lang.Integer">
    select max(workID) from employee
  </select>

    <resultMap id="EmployeeByPageWithSalary" type="org.youyuan.vhr.bean.Employee" extends="BaseResultMap">
        <association property="salary" javaType="org.youyuan.vhr.bean.Salary">
            <id column="sid" property="id" jdbcType="INTEGER"/>
            <result column="sbasicSalary" property="basicsalary" jdbcType="INTEGER"/>
            <result column="sbonus" property="bonus" jdbcType="INTEGER"/>
            <result column="slunchSalary" property="lunchsalary" jdbcType="INTEGER"/>
            <result column="strafficSalary" property="trafficsalary" jdbcType="INTEGER"/>
            <result column="sallSalary" property="allsalary" jdbcType="INTEGER"/>
            <result column="spensionBase" property="pensionbase" jdbcType="INTEGER"/>
            <result column="spensionPer" property="pensionper" jdbcType="REAL"/>
            <result column="screateDate" property="createdate" jdbcType="TIMESTAMP"/>
            <result column="smedicalBase" property="medicalbase" jdbcType="INTEGER"/>
            <result column="smedicalPer" property="medicalper" jdbcType="REAL"/>
            <result column="saccumulationFundBase" property="accumulationfundbase" jdbcType="INTEGER"/>
            <result column="saccumulationFundPer" property="accumulationfundper" jdbcType="REAL"/>
            <result column="sname" property="name" jdbcType="VARCHAR"/>
        </association>
        <association property="department" javaType="org.youyuan.vhr.bean.Department">
            <id column="id" property="id" jdbcType="INTEGER"/>
            <result column="dname" property="name" jdbcType="VARCHAR"/>
        </association>
    </resultMap>
    <!--获取员工账套-->
    <select id="getEmployeeByPageWithSalary" resultMap="EmployeeByPageWithSalary">
        SELECT e.*,
        d.`name` AS dname,
        s.id AS sid ,
        s.basicSalary AS sbasicSalary,
        s.bonus AS sbonus,
        s.lunchSalary AS slunchSalary,
        s.trafficSalary AS strafficSalary,
        s.pensionBase AS spensionBase,
        s.pensionPer AS spensionPer,
        s.createDate AS screateDate,
        s.medicalBase AS smedicalBase,
        s.medicalPer AS smedicalPer,
        s.accumulationFundBase AS saccumulationFundBase,
        s.accumulationFundPer AS saccumulationFundPer ,
        s.name AS sname
        FROM employee e LEFT JOIN empsalary es ON e.id = es.eid LEFT JOIN salary s ON es.sid = s.id
        LEFT JOIN department d on e.departmentId = d.id order by e.id
        <if test="page!=null and size!=null">
            limit #{page},#{size}
        </if>

    </select>
</mapper>